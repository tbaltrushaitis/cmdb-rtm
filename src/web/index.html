<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--[if IE 9]> <html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" class="ie9"> <![endif]-->
<!--[if IE 10]> <html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" class="ie10"> <![endif]-->
<!--[if !IE]><!--> <html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" class="noie"> <!--<![endif]-->
<head>
  <!--/  Basic Page Needs
  ========================================================================= /-->
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
  <meta http-equiv="Content-Type"    content="text/html; charset=utf-8" />

  <title>Real-time Tasks Progress Visualized Monitoring</title>

  <!--/  Mobile Specific Metas
  ========================================================================= /-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <!--/  Metas
  ========================================================================= /-->
  <meta name="title"         content="Real-Time Visualized Monitoring" />
  <meta name="description"   content="Realtime Monitoring of Job's Progress" />
  <meta name="keywords"      content="data, visualization, real-time monitoring, charts, graphs, graphics" />
  <meta name="author"        content="Baltrushaitis Tomas" />
  <meta name="language"      content="en" />
  <meta name="robots"        content="index, nofollow, noarchive" />
  <meta name="revisit-after" content="15 days" />

  <!--/  Metas for Crawlers
  ========================================================================= /-->
  <meta property="og:type"        content="demo" />
  <meta property="og:title"       content="CMDB - Real-Time Monitoring" />
  <meta property="og:description" content="Real-time Tasks Progress Visualized Monitoring" />
  <meta property="og:image"       content="assets/img/placeholder.png" />
  <meta property="og:site_name"   content="CMDB-RTM Proof of Concept" />
  <meta property="og:url"         content="https://github.com/tbaltrushaitis/cmdb-rtm" />
  <meta property="og:see_also"    content="https://github.com/tbaltrushaitis" />

  <!--/  Stylesheets
  ========================================================================= /-->

  <!--/  Bootstrap  /-->
  <link as="style" rel="preload" href="assets/css/bootstrap.min.css" onload="this.onload=null;this.rel='stylesheet'" />
  <noscript><link rel="stylesheet" href="assets/css/bootstrap.min.css" /></noscript>

  <link as="style" rel="preload" href="assets/css/bootstrap-theme.min.css" onload="this.onload=null;this.rel='stylesheet'" />
  <noscript><link rel="stylesheet" href="assets/css/bootstrap-theme.min.css" /></noscript>

  <link as="style" rel="preload" href="assets/css/animate.min.css" onload="this.onload=null;this.rel='stylesheet'" />
  <noscript><link rel="stylesheet" href="assets/css/animate.min.css" /></noscript>

  <link as="style" rel="preload" href="assets/css/style.css" onload="this.onload=null;this.rel='stylesheet'" />
  <noscript><link rel="stylesheet" href="assets/css/style.css" /></noscript>

  <!--/  Favicon  /-->
  <link href="assets/img/favicon.ico" type="image/x-icon" rel="icon" />
  <link href="assets/img/favicon.ico" type="image/x-icon" rel="shortcut icon" />

</head>

<body>

  <div id="container" class="container">

    <div class="page-header">
      <h2 class="text-warning">View:<small id="client-id"></small></h2>
    </div>

    <section id="tasks-stats" class="section content">
      <h3 class="text-success">Tasks Queue</h3>
      <div class="row">
          <ul id="tasks-legend" class="list-unstyled hidden">
            <li>Slow: <span id="tasks-slow"></span></li>
            <li>Norm: <span id="tasks-norm"></span></li>
            <li>Fast: <span id="tasks-fast"></span></li>
            <li>TOTAL: <span id="tasks-total"></span></li>
          </ul>
      </div>
    </section>

    <section class="section content">
      <div class="row">
        <div class="col-sm-10">
          <div id="tasks-monitor">
          </div>
        </div>
      </div>
    </section>

  </div>

  <div id="template">
    <div class="progress progress-striped active progress-container animated">
      <div class="progress-bar progress-bar-primary">
        <span class="progress-text">
          <span class="progress-task"></span>
          <span class="progress-d">-</span>
          <span class="progress-data">?%</span>
        </span>
      </div>
    </div>
  </div>

  <script type="text/javascript" src="assets/js/lib/jquery.slim.min.js"></script>
  <script type="text/javascript" src="assets/js/lib/bootstrap.min.js"></script>
  <script type="text/javascript" src="assets/js/lib/lodash.min.js"></script>

  <!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script> -->
  <script type="text/javascript" src="assets/js/lib/socket.io.js"></script>
  <script type="text/javascript" src="assets/js/app/progress.js"></script>

  <script>

    $(function () {

      let ioClient = io()
        , aSpds    = ['total', 'fast', 'norm', 'slow']
        , entries  = aSpds.map((x) => { return [[`${x}`], 0] })
      ;
      window.aStats = Object.fromEntries(entries);

      // console.log(`entries (${typeof entries}):`, entries);
      console.log(`[ioClient] window.aStats (${typeof window.aStats}):`, window.aStats);
      console.log(`[ioClient] (${typeof ioClient}):`, ioClient);

      ioClient.on('connect', () => {
        console.info(`[ioClient] Connected to ioServer as: [${ioClient.id}]`);
        $('#client-id').text( ioClient.id );
      });

      ioClient.on('disconnect', function () {
        console.warn(`[ioClient] Disconnected from ioServer!`);
      });

      ioClient.on('message', function (job) {
        // console.log(`[ioClient] RECV: message`);
        $('#template').progressBar(job);
      });

      ioClient.on('progress', function (job) {
        console.log(`[ioClient] RECV progress for [jobId:${job.id}]`);
        $('#template').progressBar(job);
      });

      ioClient.connect();

    });
  </script>

</body>
</html>
